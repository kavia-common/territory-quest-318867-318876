{"is_source_file": true, "format": "JavaScript", "description": "This file contains middleware functions for authentication in a Node.js web server, utilizing Supabase for token verification. It exports two functions, 'authenticate' which enforces authentication, and 'optionalAuth' which attempts authentication without failure if no token is provided.", "external_files": ["../utils/logger.js", "@supabase/supabase-js"], "external_methods": ["createClient", "supabase.auth.getUser"], "published": ["authenticate", "optionalAuth"], "classes": [], "methods": [{"name": "authenticate", "description": "Middleware that validates JWT tokens from the Authorization header using Supabase and attaches user info to the request object."}, {"name": "optionalAuth", "description": "Middleware that optionally authenticates a request, attaching user info if a valid token is present, but not failing otherwise."}], "calls": ["supabase.auth.getUser", "logger.warn", "logger.error"], "search-terms": ["auth middleware", "JWT token verification", "Supabase authentication", "Node.js middleware", "authorization header parsing"], "state": 2, "file_id": 11, "knowledge_revision": 38, "git_revision": "c2b4720579c8e11ff8f0ec060c27f46eeddaf35b", "ctags": [{"_type": "tag", "name": "authHeader", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/middleware/auth.js", "pattern": "/^    const authHeader = req.headers.authorization;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authenticate", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/middleware/auth.js", "pattern": "/^export const authenticate = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "optionalAuth", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/middleware/auth.js", "pattern": "/^export const optionalAuth = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "supabase", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/middleware/auth.js", "pattern": "/^const supabase = createClient($/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/middleware/auth.js", "pattern": "/^    const token = authHeader.substring(7); \\/\\/ Remove 'Bearer ' prefix$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/middleware/auth.js", "pattern": "/^    const token = authHeader.substring(7);$/", "language": "JavaScript", "kind": "constant"}], "hash": "67b0418cd69cf0f241069c3a8d66c3cc", "format-version": 4, "code-base-name": "game_backend", "filename": "game_backend/src/middleware/auth.js", "revision_history": [{"38": "c2b4720579c8e11ff8f0ec060c27f46eeddaf35b"}]}