{"is_source_file": true, "format": "JavaScript (ES Modules syntax)", "description": "This is the main server source file for the backend of a territory capture game. It sets up an Express application, configures middleware (security, CORS, rate limiting, logging, request timeout), defines root and documentation endpoints, integrates health checks, initializes WebSocket server, and manages server startup and graceful shutdown procedures.", "external_files": ["./middleware/errorHandler.js", "./middleware/requestLogger.js", "./middleware/requestTimeout.js", "./middleware/notFoundHandler.js", "./utils/logger.js", "./routes/index.js", "./routes/health.js", "./websocket/index.js"], "external_methods": ["dotenv.config", "helmet()", "cors()", "rateLimit()", "readFileSync()", "fileURLToPath()", "dirname()", "join()", "initializeWebSocket()"], "published": ["app.get", "app.use", "app.listen", "initializeWebSocket"], "classes": [{"name": "WebSocketServer", "description": "WebSocket server instance used for real-time communication, initialized with the HTTP server and path '/ws'."}], "methods": [{"name": "gracefulShutdown", "description": "Handles server shutdown, closing HTTP and WebSocket connections gracefully upon receiving termination signals."}, {"name": "AnonymousFunctionbcb6272f0100(origin, callback)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["dotenv.config", "app.use", "app.get", "app.listen", "initializeWebSocket", "wss.clients.forEach", "wss.close", "logger.info", "logger.error", "process.on"], "search-terms": ["websocket server", "graceful shutdown", "environment configuration", "middleware setup", "API documentation endpoint", "health check routes", "WebSocket initialization"], "state": 2, "file_id": 6, "knowledge_revision": 90, "git_revision": "48a8f4bc6ce83e17c36db87c057f7e282740e193", "revision_history": [{"33": "c2b4720579c8e11ff8f0ec060c27f46eeddaf35b"}, {"77": "6d79e27fd64839ad21aa8f41944d816f6dd38be0"}, {"80": "04b3246851ae10567b69695e835750ddfc87619e"}, {"87": "9bd7d0b8c5d9ac40e9fc274fdba1c73e27818d24"}, {"90": "48a8f4bc6ce83e17c36db87c057f7e282740e193"}], "ctags": [{"_type": "tag", "name": "ALLOWED_ORIGINS", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const ALLOWED_ORIGINS = process.env.ALLOWED_ORIGINS$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "AnonymousFunctionbcb6272f0100", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^  origin: function (origin, callback) {$/", "language": "JavaScript", "kind": "function", "signature": "(origin, callback)"}, {"_type": "tag", "name": "NODE_ENV", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const NODE_ENV = process.env.NODE_ENV || 'development';$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "PORT", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const PORT = process.env.PORT || 3001;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "REQUEST_TIMEOUT_MS", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const REQUEST_TIMEOUT_MS = parseInt(process.env.REQUEST_TIMEOUT_MS || '30000');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "__dirname", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const __dirname = dirname(__filename);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "__filename", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const __filename = fileURLToPath(import.meta.url);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const app = express();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "checkConnections", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^  const checkConnections = setInterval(() => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "gracefulShutdown", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const gracefulShutdown = (signal) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "httpServer", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const httpServer = createServer(app);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "isShuttingDown", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^let isShuttingDown = false;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "limiter", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const limiter = rateLimit({$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "shutdownTimeout", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^  const shutdownTimeout = setTimeout(() => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "wss", "path": "/home/kavia/workspace/code-generation/territory-quest-318867-318876/game_backend/src/server.js", "pattern": "/^const wss = new WebSocketServer({ $/", "language": "JavaScript", "kind": "constant"}], "hash": "af78f73957058c52a807113a765aee2f", "format-version": 4, "code-base-name": "game_backend", "filename": "game_backend/src/server.js", "fields": [{"name": "let isShuttingDown = false;", "scope": "", "scopeKind": "", "description": "unavailable"}]}